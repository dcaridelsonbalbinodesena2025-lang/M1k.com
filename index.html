<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.C.M ELITE V13 - ARIDELSON B.</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --neon-green: #00ff88; --neon-red: #ff3355; --gale: #f0b90b; --royal-blue: #0047AB; }
        body { background: #05070a; color: white; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; min-height: 95vh; margin: 0; }
        #celular { background: #111418; width: 360px; height: 660px; border-radius: 45px; border: 8px solid #2b2f36; padding: 15px; box-shadow: 0 0 60px rgba(0, 71, 171, 0.5); display: flex; flex-direction: column; position: relative; }
        .header { text-align: center; margin-top: 10px; }
        .logo-container { font-size: 42px; font-weight: 900; color: #1e90ff; text-transform: uppercase; font-style: italic; letter-spacing: -2px; text-shadow: 0 0 20px rgba(30, 144, 255, 0.9); }
        .termometro-container { margin: 10px 0; background: #222; height: 35px; border-radius: 50px; overflow: hidden; border: 2px solid #444; }
        #barra-pressao { height: 100%; width: 50%; transition: 0.3s; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 18px; color: #000; }
        #visor-velas { height: 50px; background: rgba(0,0,0,0.4); border-radius: 20px; display: flex; gap: 8px; align-items: center; justify-content: center; margin-bottom: 10px; }
        .barra { width: 14px; height: 28px; border-radius: 3px; }
        .verde { background: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); }
        .vermelha { background: var(--neon-red); box-shadow: 0 0 10px var(--neon-red); }
        #balao-instrucao { padding: 20px; border-radius: 15px; font-size: 20px; font-weight: 900; text-align: center; margin-bottom: 10px; border: 2px solid rgba(255,255,255,0.1); min-height: 80px; display: flex; align-items: center; justify-content: center; background: #111; }
        #timer { font-size: 85px; font-weight: bold; text-align: center; line-height: 1; }
        #preco { font-size: 24px; color: var(--gale); font-weight: bold; text-align: center; font-family: monospace; margin-bottom: 5px; }
        #grafico-container { height: 120px; position: relative; }
        #area-resultado { height: 60px; display: flex; align-items: center; justify-content: center; }
        .resultado-texto { font-size: 45px; font-weight: 900; display: none; z-index: 10; }
        .footer-tools { background: rgba(255,255,255,0.05); border-radius: 25px; padding: 12px; margin-top: auto; }
        select { width: 100%; padding: 10px; background: #1a1e23; color: white; border-radius: 10px; border: 1px solid #444; font-size: 12px; margin-top: 5px; }
        .assinatura { text-align: right; font-size: 12px; font-weight: bold; color: #555; margin-top: 5px; padding-right: 10px; }
    </style>
</head>
<body>

    <div id="celular">
        <div class="header"><div class="logo-container">K.CüìàM</div></div>
        <div class="termometro-container"><div id="barra-pressao">50%</div></div>
        <div id="visor-velas"></div>
        <div id="balao-instrucao">ANALISANDO...</div>
        <div id="timer">00</div>
        <div id="preco">0.00000</div>
        <div id="grafico-container"><canvas id="realTimeChart"></canvas></div>
        <div id="area-resultado">
            <div id="msg-green" class="resultado-texto" style="color: var(--neon-green);">GREEN! ‚úÖ</div>
            <div id="msg-red" class="resultado-texto" style="color: var(--neon-red);">RED! ‚ùå</div>
        </div>
        <div class="footer-tools">
            <div style="display: flex; justify-content: space-around; font-weight: bold; margin-bottom: 5px;">
                <span style="color:var(--neon-green)">W: <span id="wins">0</span></span>
                <span id="hit" style="color: var(--gale)">100%</span>
                <span style="color:var(--neon-red)">L: <span id="reds">0</span></span>
            </div>
            <select id="moeda-select" onchange="mudarMoeda()">
                <optgroup label="Forex">
                    <option value="frxEURUSD">EUR / USD</option>
                    <option value="frxGBPUSD">GBP / USD</option>
                    <option value="frxUSDJPY">USD / JPY</option>
                    <option value="frxEURGBP">EUR / GBP</option>
                    <option value="frxAUDUSD">AUD / USD</option>
                    <option value="frxUSDBRL">USD / BRL (OTC)</option>
                </optgroup>
                <optgroup label="Sint√©ticos / Volatilidade">
                    <option value="R_10">Volatility 10</option>
                    <option value="R_25">Volatility 25</option>
                    <option value="R_50">Volatility 50</option>
                    <option value="R_75">Volatility 75</option>
                    <option value="R_100">Volatility 100</option>
                    <option value="1HZ10V">Volatility 10 (1s)</option>
                    <option value="1HZ100V">Volatility 100 (1s)</option>
                </optgroup>
                <optgroup label="Cripto">
                    <option value="cryBTCUSD">BITCOIN / USD</option>
                    <option value="cryETHUSD">ETHEREUM / USD</option>
                </optgroup>
            </select>
            <div class="assinatura">Aridelson B.</div>
        </div>
    </div>

    <script>
        let socket, precosVela = [], dadosVelas = [];
        let wins = 0, reds = 0, galeAtual = 0;
        let sinalIdentificado = null, operacaoAtiva = null, aguardandoRetracao = false;
        let precoAberturaVelaAnterior = 0, precoFechamentoVelaAnterior = 0;
        let precoEntrada = 0, tempoRestanteOperacao = 0;
        let chart;

        const ctx = document.getElementById('realTimeChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: { labels: Array(20).fill(''), datasets: [{ data: Array(20).fill(null), borderColor: '#0047AB', borderWidth: 2, pointRadius: 0, fill: true, backgroundColor: 'rgba(0, 71, 171, 0.1)', tension: 0.3 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { display: false }, x: { display: false } }, plugins: { legend: { display: false } } }
        });

        function conectar(ativo) {
            if (socket) socket.close();
            socket = new WebSocket('wss://ws.binaryws.com/websockets/v3?app_id=1089');
            socket.onopen = () => socket.send(JSON.stringify({ ticks: ativo }));
            socket.onmessage = (msg) => {
                const data = JSON.parse(msg.data);
                if (data.tick) {
                    const preco = data.tick.quote, segs = new Date().getSeconds();
                    if (precosVela.length === 0) precosVela.push(preco);
                    document.getElementById('timer').innerText = (60 - segs).toString().padStart(2, '0');
                    document.getElementById('preco').innerText = preco.toFixed(5);
                    chart.data.datasets[0].data.push(preco); chart.data.datasets[0].data.shift(); chart.update('none');
                    let pct = 50 + ((preco - precosVela[0]) / 0.00012 * 50);
                    pct = Math.max(5, Math.min(95, pct));
                    atualizarTermometro(pct);

                    if (tempoRestanteOperacao > 0) {
                        processarTempoOperacao(preco);
                    } else {
                        if (segs >= 45 && !aguardandoRetracao) identificarSinal(pct);
                        if (segs <= 30 && aguardandoRetracao) verificarGatilhoRetracao(preco, segs);
                        if (segs > 30 && aguardandoRetracao) abortarSinal();
                    }
                    if (segs === 0) fecharVela(preco);
                }
            };
        }

        function atualizarTermometro(pct) {
            const barra = document.getElementById('barra-pressao');
            barra.style.width = pct + "%";
            barra.style.background = pct >= 80 ? "var(--neon-green)" : pct <= 20 ? "var(--neon-red)" : "var(--gale)";
            barra.innerText = Math.round(pct) + "%"; 
        }

        function identificarSinal(pct) {
            const bSinal = document.getElementById('balao-instrucao');
            if (pct >= 85) { sinalIdentificado = "CALL"; bSinal.innerText = "PREPARE CALL (AGUARDE TAXA)"; bSinal.style.background = "var(--gale)"; bSinal.style.color = "#000"; }
            else if (pct <= 15) { sinalIdentificado = "PUT"; bSinal.innerText = "PREPARE PUT (AGUARDE TAXA)"; bSinal.style.background = "var(--gale)"; bSinal.style.color = "#000"; }
        }

        function verificarGatilhoRetracao(precoAtual, segs) {
            const bSinal = document.getElementById('balao-instrucao');
            const alvoRetracao = Math.abs(precoFechamentoVelaAnterior - precoAberturaVelaAnterior) * 0.30 || 0.00008;

            if ((sinalIdentificado === "CALL" && precoAtual <= (precosVela[0] - alvoRetracao)) || 
                (sinalIdentificado === "PUT" && precoAtual >= (precosVela[0] + alvoRetracao))) {
                
                let tipo = sinalIdentificado;
                bSinal.innerText = "ENTRE AGORA: " + tipo + "!";
                bSinal.style.background = tipo === "CALL" ? "var(--neon-green)" : "var(--neon-red)";
                bSinal.style.color = "#000";
                
                // Segura a mensagem de entrada por 2 segundos antes de iniciar o contador de 60s
                setTimeout(() => { if(!operacaoAtiva) iniciarOperacao(precoAtual, tipo); }, 1500);
            } else {
                bSinal.innerText = `BUSCANDO MELHOR TAXA... (${30 - segs}s)`;
                bSinal.style.background = "#111"; bSinal.style.color = "#fff";
            }
        }

        function iniciarOperacao(preco, tipo) {
            precoEntrada = preco; operacaoAtiva = tipo; tempoRestanteOperacao = 60;
            aguardandoRetracao = false; sinalIdentificado = null;
        }

        function processarTempoOperacao(precoAtual) {
            tempoRestanteOperacao--;
            const bSinal = document.getElementById('balao-instrucao');
            bSinal.innerText = `ESPERANDO CONCLUS√ÉO: ${tempoRestanteOperacao}s`;
            bSinal.style.background = "var(--royal-blue)"; bSinal.style.color = "#fff";
            if (tempoRestanteOperacao <= 0) verificarResultadoFinal(precoAtual);
        }

        function verificarResultadoFinal(precoFinal) {
            const win = (operacaoAtiva === "CALL" && precoFinal > precoEntrada) || 
                        (operacaoAtiva === "PUT" && precoFinal < precoEntrada);
            const bSinal = document.getElementById('balao-instrucao');
            const opAnterior = operacaoAtiva;

            if (win) {
                wins++; mostrarResultado('green'); galeAtual = 0;
                resetBalao(bSinal);
            } else if (galeAtual < 2) {
                galeAtual++;
                bSinal.innerText = `GALE ${galeAtual}: ENTRE NO ${opAnterior} AGORA!`;
                bSinal.style.background = "var(--gale)"; bSinal.style.color = "#000";
                // Inicia o Gale ap√≥s 3 segundos da mensagem de erro
                setTimeout(() => { iniciarOperacao(precoFinal, opAnterior); }, 3000);
            } else {
                reds++; mostrarResultado('red'); galeAtual = 0;
                resetBalao(bSinal);
            }
            operacaoAtiva = null;
            atualizarPlacar();
        }

        function resetBalao(el) {
            setTimeout(() => { el.innerText = "ANALISANDO..."; el.style.background = "#111"; el.style.color = "#fff"; }, 3500);
        }

        function abortarSinal() {
            if (!aguardandoRetracao) return;
            const bSinal = document.getElementById('balao-instrucao');
            bSinal.innerText = "TAXA N√ÉO ATINGIDA: ABORTADO";
            aguardandoRetracao = false; sinalIdentificado = null;
            resetBalao(bSinal);
        }

        function fecharVela(fe) {
            const ab = precosVela[0];
            precoAberturaVelaAnterior = ab; precoFechamentoVelaAnterior = fe;
            if (sinalIdentificado !== null && tempoRestanteOperacao <= 0) aguardandoRetracao = true;
            dadosVelas.push({ cor: fe >= ab ? 'verde' : 'vermelha' });
            if (dadosVelas.length > 10) dadosVelas.shift();
            atualizarVelas(); precosVela = [fe];
        }

        function mostrarResultado(tipo) { 
            const el = document.getElementById('msg-' + tipo); el.style.display = 'block'; 
            setTimeout(() => { el.style.display = 'none'; }, 3500); 
        }

        function atualizarVelas() { 
            const c = document.getElementById('visor-velas'); c.innerHTML = ''; 
            dadosVelas.forEach(v => { const b = document.createElement('div'); b.className = `barra ${v.cor}`; c.appendChild(b); }); 
        }

        function atualizarPlacar() { 
            document.getElementById('wins').innerText = wins; document.getElementById('reds').innerText = reds; 
            let t = wins + reds; document.getElementById('hit').innerText = (t > 0 ? ((wins/t)*100).toFixed(0) : 0) + "%"; 
        }

        function mudarMoeda() { 
            wins=0; reds=0; galeAtual=0; operacaoAtiva=null; tempoRestanteOperacao=0; 
            aguardandoRetracao=false; sinalIdentificado=null; dadosVelas=[]; precosVela=[]; 
            atualizarPlacar(); conectar(document.getElementById('moeda-select').value); 
        }
        conectar('frxEURUSD');
    </script>
</body>
</html>
